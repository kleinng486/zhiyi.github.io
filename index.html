<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企业/个体户税费计算器</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1a56db',
                        secondary: '#e2e8f0',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444',
                        info: '#3b82f6',
                        light: '#f8fafc',
                        dark: '#1e293b'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    boxShadow: {
                        card: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .transition-all {
                transition-property: all;
                transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
                transition-duration: 150ms;
            }
            .input-focus {
                @apply focus:ring-2 focus:ring-primary focus:border-primary focus:outline-none;
            }
            .card-hover {
                @apply hover:shadow-lg transition-all;
            }
            .btn-primary {
                @apply bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-all;
            }
            .btn-outline {
                @apply border border-primary text-primary px-4 py-2 rounded-md hover:bg-primary hover:text-white transition-all;
            }
            .table-header {
                @apply px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider;
            }
            .table-cell {
                @apply px-6 py-4 whitespace-nowrap text-sm text-gray-900;
            }
            .badge {
                @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium;
            }
            .badge-success {
                @apply bg-green-100 text-green-800;
            }
            .badge-warning {
                @apply bg-yellow-100 text-yellow-800;
            }
            .badge-danger {
                @apply bg-red-100 text-red-800;
            }
            .service-tag {
                @apply inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium mr-2 mb-2;
            }
        }
        
        /* 小程序水印样式 */
        .watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0.1;
            font-size: 3rem;
            font-weight: bold;
            color: #000;
            transform: rotate(-30deg);
            white-space: nowrap;
        }
        
        /* 联系方式样式 */
        .contact-info {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .contact-info i {
            width: 20px;
            text-align: center;
            margin-right: 0.5rem;
        }
        
        /* 折叠面板样式 */
        .collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        
        .collapse-content.open {
            max-height: 2000px;
            transition: max-height 0.6s ease-in;
        }
        
        .toggle-icon {
            transition: transform 0.3s ease;
        }
        
        .toggle-icon.open {
            transform: rotate(180deg);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 小程序水印 -->
    <div class="watermark">智一会计服务（佛山）有限公司</div>
    
    <div class="container mx-auto px-4 py-8">
        <!-- 页面标题 -->
        <header class="mb-8 text-center">
            <!-- 公司LOGO -->
            <div class="flex justify-center mb-4">
                <img src="https://p26-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/a830d07922c44a4a9c52cf528234d2bd.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251106134045EA1738CACD75C117AE30&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1763012445&x-signature=SqXU%2BYorAdiNF9JjZFNDJzpIPOw%3D" alt="智一会计" class="h-16">
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">企业/个体户税费计算器</h1>
            <p class="text-gray-600">快速计算不同类型纳税人的各项税费</p>
        </header>

        <!-- 主要内容区 -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧输入区域 -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-card p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fa fa-calculator mr-2 text-primary"></i>
                        税费计算
                    </h2>
                    
                    <form id="taxForm" class="space-y-4">
                        <!-- 纳税人类型 -->
                        <div>
                            <label for="taxpayerType" class="block text-sm font-medium text-gray-700 mb-1">纳税人类型</label>
                            <select id="taxpayerType" name="taxpayerType" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus">
                                <option value="company">有限公司（小规模纳税人）</option>
                                <option value="individual">个体工商户（小规模纳税人）</option>
                                <option value="general">一般纳税人</option>
                                <option value="approved">个体工商户（核定征收）</option>
                            </select>
                        </div>
                        
                        <!-- 销售额计算方式 -->
                        <div id="salesModeContainer">
                            <label class="block text-sm font-medium text-gray-700 mb-1">销售额计算方式</label>
                            <div class="flex space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="salesMode" value="allBelow" class="sales-mode-radio" checked>
                                    <span class="ml-2">每个季度均低于30万</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="salesMode" value="someAbove" class="sales-mode-radio">
                                    <span class="ml-2">有季度超过30万</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- 总销售额 -->
                        <div id="totalSalesContainer">
                            <label for="salesAmount" class="block text-sm font-medium text-gray-700 mb-1">总销售额 (元)</label>
                            <input type="number" id="salesAmount" name="salesAmount" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus" placeholder="请输入总销售额">
                        </div>
                        
                        <!-- 季度销售额 (当选择"有季度超过30万"时显示) -->
                        <div id="quarterlySalesContainer" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-1">季度销售额 (元)</label>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="q1Sales" class="block text-xs text-gray-500 mb-1">第一季度</label>
                                    <input type="number" id="q1Sales" name="q1Sales" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus quarterly-sales" placeholder="0.00">
                                </div>
                                <div>
                                    <label for="q2Sales" class="block text-xs text-gray-500 mb-1">第二季度</label>
                                    <input type="number" id="q2Sales" name="q2Sales" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus quarterly-sales" placeholder="0.00">
                                </div>
                                <div>
                                    <label for="q3Sales" class="block text-xs text-gray-500 mb-1">第三季度</label>
                                    <input type="number" id="q3Sales" name="q3Sales" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus quarterly-sales" placeholder="0.00">
                                </div>
                                <div>
                                    <label for="q4Sales" class="block text-xs text-gray-500 mb-1">第四季度</label>
                                    <input type="number" id="q4Sales" name="q4Sales" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus quarterly-sales" placeholder="0.00">
                                </div>
                            </div>
                            <div class="mt-2 flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-700">总销售额：</span>
                                <span id="totalSalesDisplay" class="ml-2 text-sm font-semibold">0.00 元</span>
                            </div>
                        </div>
                        
                        <!-- 进项成本票 -->
                        <div id="costInputContainer">
                            <label for="costAmount" class="block text-sm font-medium text-gray-700 mb-1">进项(成本票) (元)</label>
                            <input type="number" id="costAmount" name="costAmount" step="0.01" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus" placeholder="请输入进项成本票金额">
                        </div>
                        
                        <!-- 一般纳税人专用发票比例 -->
                        <div id="specialInvoiceContainer" class="hidden">
                            <label for="specialInvoiceRatio" class="block text-sm font-medium text-gray-700 mb-1">专用发票比例</label>
                            <div class="flex items-center">
                                <input type="number" id="specialInvoiceRatio" name="specialInvoiceRatio" step="0.01" min="0" max="100" value="100" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus">
                                <span class="ml-2">%</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">一般纳税人仅专用发票可抵扣进项税额，普票不可抵扣</p>
                        </div>
                        
                        <!-- 核定征收率 (仅核定征收个体户显示) -->
                        <div id="approvedRateContainer" class="hidden">
                            <label for="approvedRate" class="block text-sm font-medium text-gray-700 mb-1">核定征收率</label>
                            <div class="flex items-center">
                                <input type="number" id="approvedRate" name="approvedRate" step="0.01" min="0" max="100" value="6" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus">
                                <span class="ml-2">%</span>
                            </div>
                        </div>
                        
                        <!-- 减除费用 (仅核定征收个体户显示) -->
                        <div id="deductionContainer" class="hidden">
                            <label for="deductionAmount" class="block text-sm font-medium text-gray-700 mb-1">减除费用 (元/年)</label>
                            <input type="number" id="deductionAmount" name="deductionAmount" step="0.01" min="0" value="60000" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm input-focus">
                            <p class="text-xs text-gray-500 mt-1">默认每年60000元 (每月5000元)</p>
                        </div>
                        
                        <div class="pt-2">
                            <button type="button" id="calculateBtn" class="btn-primary w-full">
                                <i class="fa fa-calculator mr-1"></i> 计算税费
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- 计算说明 -->
                <div class="bg-white rounded-lg shadow-card p-6 mt-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fa fa-info-circle mr-2 text-primary"></i>
                        计算说明
                    </h2>
                    <div class="text-sm text-gray-600 space-y-2">
                        <p><strong>增值税：</strong>小规模纳税人按1%计算，季度销售额30万以下免征增值税</p>
                        <p><strong>一般纳税人：</strong>按13%计算销项税额，抵扣进项税额；不享受季度销售额30万以下增值税免税政策</p>
                        <p><strong>所得税：</strong>有限公司（小规模纳税人）300万以下5%，300万以上25%；个体工商户按超额累进税率计算并减半征收</p>
                        <p><strong>附加税：</strong>城建税7%、教育费附加3%、地方教育费附加2%（增值税为0时附加税也为0）</p>
                        <p><strong>印花税：</strong>不含税收入的0.03%</p>
                        <p><strong>税负率：</strong>总税费 ÷ 销售额</p>
                    </div>
                    
                    <!-- 公司服务信息 -->
                    <div class="mt-6 pt-4 border-t border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900 mb-3">我们的服务</h3>
                        <div class="flex flex-wrap">
                            <span class="service-tag">公司注册</span>
                            <span class="service-tag">代理记账</span>
                            <span class="service-tag">企业注销</span>
                            <span class="service-tag">个体户办理</span>
                            <span class="service-tag">电商合规</span>
                            <span class="service-tag">财税服务</span>
                            <span class="service-tag">税务筹划</span>
                            <span class="service-tag">社保代缴</span>
                            <span class="service-tag">商标买卖</span>
                            <span class="service-tag">专利注册</span>
                            <span class="service-tag">资质许可</span>
                            <span class="service-tag">法务咨询</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧结果区域 -->
            <div class="lg:col-span-2">
                <!-- 结果卡片 -->
                <div class="bg-white rounded-lg shadow-card p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fa fa-bar-chart mr-2 text-primary"></i>
                        计算结果
                    </h2>
                    
                    <!-- 核心结果（始终显示） -->
                    <div class="mb-6">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold text-gray-900">总税费：</span>
                                    <span id="totalTax" class="text-2xl font-bold text-primary">0.00</span>
                                </div>
                                <div class="flex justify-between items-center mt-2">
                                    <span class="text-lg font-semibold text-gray-900">综合税负率：</span>
                                    <span id="taxRate" class="text-2xl font-bold text-info">0.00%</span>
                                </div>
                            </div>
                            
                            <!-- 联系方式 -->
                            <div class="bg-blue-50 p-4 rounded-lg w-full md:w-auto">
                                <h3 class="text-lg font-medium text-gray-900 mb-3 flex items-center">
                                    <i class="fa fa-phone mr-2 text-primary"></i>
                                    联系我们
                                </h3>
                                <div class="text-sm space-y-2">
                                    <div class="contact-info">
                                        <i class="fa fa-user"></i>
                                        <span>周小姐：13751611929</span>
                                    </div>
                                    <div class="contact-info">
                                        <i class="fa fa-user"></i>
                                        <span>彭先生：18818712297</span>
                                    </div>
                                    <div class="contact-info">
                                        <i class="fa fa-user"></i>
                                        <span>伍先生：15217629694</span>
                                    </div>
                                    <div class="contact-info">
                                        <i class="fa fa-user"></i>
                                        <span>刘先生：13048035065</span>
                                    </div>
                                    <div class="mt-2 text-center text-xs text-gray-500">
                                        <i class="fa fa-wechat mr-1"></i> 微信同号码一致，欢迎咨询
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 折叠面板控制 -->
                    <div class="mb-4">
                        <button id="toggleDetailsBtn" class="flex items-center text-primary hover:text-primary/80 font-medium">
                            <span>查看详细计算</span>
                            <i class="fa fa-chevron-down ml-2 toggle-icon"></i>
                        </button>
                    </div>
                    
                    <!-- 详细计算结果（可折叠） -->
                    <div id="detailsContent" class="collapse-content">
                        <!-- 结果表格 -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="table-header">项目</th>
                                        <th scope="col" class="table-header">金额 (元)</th>
                                        <th scope="col" class="table-header">计算说明</th>
                                    </tr>
                                </thead>
                                <tbody id="resultTable" class="bg-white divide-y divide-gray-200">
                                    <!-- 结果将通过JavaScript动态填充 -->
                                    <tr>
                                        <td colspan="3" class="table-cell text-center text-gray-500">请输入数据并点击计算按钮</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- 税率表 -->
                <div class="bg-white rounded-lg shadow-card p-6 mt-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                        <i class="fa fa-table mr-2 text-primary"></i>
                        税率表
                    </h2>
                    
                    <!-- 企业所得税税率表 -->
                    <div class="mb-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-2">企业所得税税率</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="table-header">利润区间 (元)</th>
                                        <th scope="col" class="table-header">税率</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="table-cell">300万以下</td>
                                        <td class="table-cell">5%</td>
                                    </tr>
                                    <tr>
                                        <td class="table-cell">300万以上</td>
                                        <td class="table-cell">25%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 个体户所得税税率表 -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">个体户所得税税率表 (减半征收前)</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="table-header">全年应纳税所得额 (元)</th>
                                        <th scope="col" class="table-header">税率</th>
                                        <th scope="col" class="table-header">速算扣除数 (元)</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="table-cell">不超过30,000</td>
                                        <td class="table-cell">5%</td>
                                        <td class="table-cell">0</td>
                                    </tr>
                                    <tr>
                                        <td class="table-cell">超过30,000至90,000的部分</td>
                                        <td class="table-cell">10%</td>
                                        <td class="table-cell">1,500</td>
                                    </tr>
                                    <tr>
                                        <td class="table-cell">超过90,000至300,000的部分</td>
                                        <td class="table-cell">20%</td>
                                        <td class="table-cell">10,500</td>
                                    </tr>
                                    <tr>
                                        <td class="table-cell">超过300,000至500,000的部分</td>
                                        <td class="table-cell">30%</td>
                                        <td class="table-cell">40,500</td>
                                    </tr>
                                    <tr>
                                        <td class="table-cell">超过500,000的部分</td>
                                        <td class="table-cell">35%</td>
                                        <td class="table-cell">65,500</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">注：个体户享受所得税减半征收优惠，最终应应纳税额为计算结果的50%</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <div class="flex justify-center mb-2">
                <img src="https://p26-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/a830d07922c44a4a9c52cf528234d2bd.jpg~tplv-a9rns2rl98-24:720:720.image?rcl=20251106134045EA1738CACD75C117AE30&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1763012445&x-signature=SqXU%2BYorAdiNF9JjZFNDJzpIPOw%3D" alt="智一会计" class="h-10">
            </div>
            <p>© 2025 智一会计服务（佛山）有限公司 | 企业/个体户税费计算器</p>
            <p class="mt-1">仅供参考，实际税费请以税务部门计算为准</p>
        </footer>
    </div>

    <script>
        // 等待DOM加载完成
        document.addEventListener('DOMContentLoaded', function() {
            // 获取表单元素
            const taxForm = document.getElementById('taxForm');
            const taxpayerType = document.getElementById('taxpayerType');
            const salesAmount = document.getElementById('salesAmount');
            const costAmount = document.getElementById('costAmount');
            const approvedRate = document.getElementById('approvedRate');
            const deductionAmount = document.getElementById('deductionAmount');
            const calculateBtn = document.getElementById('calculateBtn');
            const resultTable = document.getElementById('resultTable');
            const totalTax = document.getElementById('totalTax');
            const taxRate = document.getElementById('taxRate');
            
            // 折叠面板元素
            const toggleDetailsBtn = document.getElementById('toggleDetailsBtn');
            const detailsContent = document.getElementById('detailsContent');
            const toggleIcon = document.querySelector('.toggle-icon');
            
            // 获取销售额计算方式相关元素
            const salesModeRadios = document.querySelectorAll('.sales-mode-radio');
            const totalSalesContainer = document.getElementById('totalSalesContainer');
            const quarterlySalesContainer = document.getElementById('quarterlySalesContainer');
            const q1Sales = document.getElementById('q1Sales');
            const q2Sales = document.getElementById('q2Sales');
            const q3Sales = document.getElementById('q3Sales');
            const q4Sales = document.getElementById('q4Sales');
            const totalSalesDisplay = document.getElementById('totalSalesDisplay');
            const quarterlySalesInputs = document.querySelectorAll('.quarterly-sales');
            
            // 获取容器元素
            const costInputContainer = document.getElementById('costInputContainer');
            const approvedRateContainer = document.getElementById('approvedRateContainer');
            const deductionContainer = document.getElementById('deductionContainer');
            const salesModeContainer = document.getElementById('salesModeContainer');
            const specialInvoiceContainer = document.getElementById('specialInvoiceContainer');
            
            // 折叠面板切换功能
            toggleDetailsBtn.addEventListener('click', function() {
                detailsContent.classList.toggle('open');
                toggleIcon.classList.toggle('open');
                
                // 更新按钮文本
                const btnText = toggleDetailsBtn.querySelector('span');
                if (detailsContent.classList.contains('open')) {
                    btnText.textContent = '收起详细计算';
                } else {
                    btnText.textContent = '查看详细计算';
                }
            });
            
            // 监听纳税人类型变化
            taxpayerType.addEventListener('change', function() {
                const type = this.value;
                
                // 根据纳税人类型显示/隐藏相关输入
                if (type === 'approved') {
                    costInputContainer.classList.add('hidden');
                    approvedRateContainer.classList.remove('hidden');
                    deductionContainer.classList.remove('hidden');
                    salesModeContainer.classList.remove('hidden');
                    specialInvoiceContainer.classList.add('hidden');
                } else if (type === 'general') {
                    costInputContainer.classList.remove('hidden');
                    approvedRateContainer.classList.add('hidden');
                    deductionContainer.classList.add('hidden');
                    salesModeContainer.classList.add('hidden');
                    specialInvoiceContainer.classList.remove('hidden');
                } else {
                    costInputContainer.classList.remove('hidden');
                    approvedRateContainer.classList.add('hidden');
                    deductionContainer.classList.add('hidden');
                    salesModeContainer.classList.remove('hidden');
                    specialInvoiceContainer.classList.add('hidden');
                }
                
                // 如果已经输入了数据，自动重新计算
                if (salesAmount.value) {
                    calculateTax();
                }
            });
            
            // 监听计算按钮点击
            calculateBtn.addEventListener('click', calculateTax);
            
            // 监听销售额计算方式变化
            salesModeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    const mode = this.value;
                    
                    if (mode === 'allBelow') {
                        totalSalesContainer.classList.remove('hidden');
                        quarterlySalesContainer.classList.add('hidden');
                    } else {
                        totalSalesContainer.classList.add('hidden');
                        quarterlySalesContainer.classList.remove('hidden');
                    }
                    
                    // 如果已经输入了数据，自动重新计算
                    if (getSalesAmount() > 0) {
                        calculateTax();
                    }
                });
            });
            
            // 监听季度销售额输入变化
            quarterlySalesInputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateTotalSalesDisplay();
                    
                    // 如果已经输入了数据，自动重新计算
                    if (getSalesAmount() > 0) {
                        calculateTax();
                    }
                });
            });
            
            // 监听其他输入框变化，自动计算
            [salesAmount, costAmount, approvedRate, deductionAmount].forEach(input => {
                input.addEventListener('input', function() {
                    // 只有当输入框有值时才自动计算
                    if (this.value && getSalesAmount() > 0) {
                        calculateTax();
                    }
                });
            });
            
            // 更新总销售额显示
            function updateTotalSalesDisplay() {
                const q1 = parseFloat(q1Sales.value) || 0;
                const q2 = parseFloat(q2Sales.value) || 0;
                const q3 = parseFloat(q3Sales.value) || 0;
                const q4 = parseFloat(q4Sales.value) || 0;
                const total = q1 + q2 + q3 + q4;
                totalSalesDisplay.textContent = formatCurrency(total) + ' 元';
            }
            
            // 获取总销售额
            function getSalesAmount() {
                const mode = document.querySelector('input[name="salesMode"]:checked').value;
                
                if (mode === 'allBelow') {
                    return parseFloat(salesAmount.value) || 0;
                } else {
                    const q1 = parseFloat(q1Sales.value) || 0;
                    const q2 = parseFloat(q2Sales.value) || 0;
                    const q3 = parseFloat(q3Sales.value) || 0;
                    const q4 = parseFloat(q4Sales.value) || 0;
                    return q1 + q2 + q3 + q4;
                }
            }
            
            // 税费计算函数
            function calculateTax() {
                // 获取输入值
                const type = taxpayerType.value;
                const cost = parseFloat(costAmount.value) || 0;
                const approvedRateValue = parseFloat(approvedRate.value) || 0;
                const deduction = parseFloat(deductionAmount.value) || 0;
                const specialInvoiceRatio = parseFloat(document.getElementById('specialInvoiceRatio').value) || 0;
                
                // 获取销售额和销售模式
                const salesMode = document.querySelector('input[name="salesMode"]:checked').value;
                let sales = 0;
                let quarterlySales = [];
                
                if (type === 'general') {
                    // 一般纳税人不区分季度销售额模式
                    sales = parseFloat(salesAmount.value) || 0;
                    // 按季度平均分配销售额
                    const quarterlyAmount = sales / 4;
                    quarterlySales = [quarterlyAmount, quarterlyAmount, quarterlyAmount, quarterlyAmount];
                } else if (salesMode === 'allBelow') {
                    sales = parseFloat(salesAmount.value) || 0;
                    // 平均分配到4个季度
                    const quarterlyAmount = sales / 4;
                    quarterlySales = [quarterlyAmount, quarterlyAmount, quarterlyAmount, quarterlyAmount];
                } else {
                    const q1 = parseFloat(q1Sales.value) || 0;
                    const q2 = parseFloat(q2Sales.value) || 0;
                    const q3 = parseFloat(q3Sales.value) || 0;
                    const q4 = parseFloat(q4Sales.value) || 0;
                    quarterlySales = [q1, q2, q3, q4];
                    sales = q1 + q2 + q3 + q4;
                }
                
                // 验证输入
                if (sales <= 0) {
                    alert('请输入有效的销售额');
                    return;
                }
                
                // 计算结果对象
                const result = {
                    sales: sales,
                    cost: cost,
                    quarterlySales: quarterlySales,
                    profit: 0,
                    taxExcludedSales: 0,
                    vat: 0,
                    vatRate: 0,
                    incomeTax: 0,
                    surtax: 0,
                    stampTax: 0,
                    totalTax: 0,
                    taxRate: 0,
                    calculations: {
                        quarterlyDetails: []
                    }
                };
                
                // 根据纳税人类型计算各项税费
                switch (type) {
                    case 'company': // 有限公司（小规模纳税人）
                        calculateCompanyTax(result);
                        break;
                    case 'individual': // 个体工商户（小规模纳税人）
                        calculateIndividualTax(result);
                        break;
                    case 'general': // 一般纳税人
                        calculateGeneralTax(result);
                        break;
                    case 'approved': // 个体工商户（核定征收）
                        calculateApprovedTax(result, approvedRateValue, deduction);
                        break;
                }
                
                // 更新结果表格
                updateResultTable(result, type);
                
                // 更新总税费和税负率
                totalTax.textContent = formatCurrency(result.totalTax);
                taxRate.textContent = formatPercentage(result.taxRate);
            }
            
            // 计算有限公司（小规模纳税人）税费
            function calculateCompanyTax(result) {
                // 计算不含税销售额 (小规模纳税人 1%)
                result.vatRate = 0.01;
                result.taxExcludedSales = result.sales / (1 + result.vatRate);
                result.calculations.taxExcludedSales = `${result.sales.toFixed(2)} ÷ (1 + 1%) = ${result.taxExcludedSales.toFixed(2)}`;
                
                // 计算增值税
                // 小规模纳税人季度销售额30万以下免征增值税
                const quarterlySalesThreshold = 300000; // 季度销售额30万
                let totalVat = 0;
                let vatCalculationSteps = [];
                
                // 分季度计算增值税
                result.quarterlySales.forEach((quarterlySale, index) => {
                    const quarter = index + 1;
                    const quarterlyTaxExcluded = quarterlySale / (1 + result.vatRate);
                    let quarterlyVat = 0;
                    let quarterlyCalculation = '';
                    
                    if (quarterlySale <= quarterlySalesThreshold) {
                        quarterlyVat = 0;
                        quarterlyCalculation = `第${quarter}季度销售额${quarterlySale.toFixed(2)}元 ≤ 300000元，免征增值税`;
                    } else {
                        quarterlyVat = quarterlySale - quarterlyTaxExcluded;
                        quarterlyCalculation = `第${quarter}季度: ${quarterlySale.toFixed(2)} - ${quarterlyTaxExcluded.toFixed(2)} = ${quarterlyVat.toFixed(2)}`;
                    }
                    
                    totalVat += quarterlyVat;
                    vatCalculationSteps.push(quarterlyCalculation);
                    
                    // 保存季度详情
                    result.calculations.quarterlyDetails.push({
                        quarter: quarter,
                        sales: quarterlySale,
                        vat: quarterlyVat,
                        isTaxExempt: quarterlySale <= quarterlySalesThreshold
                    });
                });
                
                result.vat = totalVat;
                result.calculations.vat = vatCalculationSteps.join('<br>');
                
                // 计算利润
                result.profit = result.sales - result.cost;
                result.calculations.profit = `${result.sales.toFixed(2)} - ${result.cost.toFixed(2)} = ${result.profit.toFixed(2)}`;
                
                // 计算企业所得税 (300万以下5%，300万以上25%)
                const incomeTaxRate = result.profit <= 3000000 ? 0.05 : 0.25;
                result.incomeTax = result.profit * incomeTaxRate;
                result.calculations.incomeTax = `${result.profit.toFixed(2)} × ${(incomeTaxRate * 100).toFixed(0)}% = ${result.incomeTax.toFixed(2)}`;
                
                // 计算附加税 (城建税7% + 教育费附加3% + 地方教育费附加2% = 12%)
                const surtaxRate = 0.12;
                result.surtax = result.vat * surtaxRate;
                result.calculations.surtax = `${result.vat.toFixed(2)} × 12% = ${result.surtax.toFixed(2)}`;
                
                // 计算印花税 (不含税收入的0.03%)
                result.stampTax = result.taxExcludedSales * 0.0003;
                result.calculations.stampTax = `${result.taxExcludedSales.toFixed(2)} × 0.03% = ${result.stampTax.toFixed(2)}`;
                
                // 计算总税费
                result.totalTax = result.vat + result.incomeTax + result.surtax + result.stampTax;
                
                // 计算税负率
                result.taxRate = result.totalTax / result.sales;
            }
            
            // 计算个体户税费
            function calculateIndividualTax(result) {
                // 计算不含税销售额 (小规模纳税人 1%)
                result.vatRate = 0.01;
                result.taxExcludedSales = result.sales / (1 + result.vatRate);
                result.calculations.taxExcludedSales = `${result.sales.toFixed(2)} ÷ (1 + 1%) = ${result.taxExcludedSales.toFixed(2)}`;
                
                // 计算增值税
                // 小规模纳税人季度销售额30万以下免征增值税
                const quarterlySalesThreshold = 300000; // 季度销售额30万
                let totalVat = 0;
                let vatCalculationSteps = [];
                
                // 分季度计算增值税
                result.quarterlySales.forEach((quarterlySale, index) => {
                    const quarter = index + 1;
                    const quarterlyTaxExcluded = quarterlySale / (1 + result.vatRate);
                    let quarterlyVat = 0;
                    let quarterlyCalculation = '';
                    
                    if (quarterlySale <= quarterlySalesThreshold) {
                        quarterlyVat = 0;
                        quarterlyCalculation = `第${quarter}季度销售额${quarterlySale.toFixed(2)}元 ≤ 300000元，免征增值税`;
                    } else {
                        quarterlyVat = quarterlySale - quarterlyTaxExcluded;
                        quarterlyCalculation = `第${quarter}季度: ${quarterlySale.toFixed(2)} - ${quarterlyTaxExcluded.toFixed(2)} = ${quarterlyVat.toFixed(2)}`;
                    }
                    
                    totalVat += quarterlyVat;
                    vatCalculationSteps.push(quarterlyCalculation);
                    
                    // 保存季度详情
                    result.calculations.quarterlyDetails.push({
                        quarter: quarter,
                        sales: quarterlySale,
                        vat: quarterlyVat,
                        isTaxExempt: quarterlySale <= quarterlySalesThreshold
                    });
                });
                
                result.vat = totalVat;
                result.calculations.vat = vatCalculationSteps.join('<br>');
                
                // 计算利润
                result.profit = result.sales - result.cost;
                result.calculations.profit = `${result.sales.toFixed(2)} - ${result.cost.toFixed(2)} = ${result.profit.toFixed(2)}`;
                
                // 计算个体户所得税 (超额累进税率)
                const taxableIncome = result.profit;
                let incomeTax = 0;
                let calculationSteps = [];
                
                if (taxableIncome > 0) {
                    // 个体户所得税税率表
                    const taxBrackets = [
                        { threshold: 30000, rate: 0.05, deduction: 0 },
                        { threshold: 90000, rate: 0.10, deduction: 1500 },
                        { threshold: 300000, rate: 0.20, deduction: 10500 },
                        { threshold: 500000, rate: 0.30, deduction: 40500 },
                        { threshold: Infinity, rate: 0.35, deduction: 65500 }
                    ];
                    
                    // 找到适用的税率档次
                    let applicableBracket = null;
                    for (const bracket of taxBrackets) {
                        if (taxableIncome <= bracket.threshold) {
                            applicableBracket = bracket;
                            break;
                        }
                    }
                    
                    // 计算应纳税额
                    const preTax = taxableIncome * applicableBracket.rate - applicableBracket.deduction;
                    calculationSteps.push(`${taxableIncome.toFixed(2)} × ${(applicableBracket.rate * 100).toFixed(0)}% - ${applicableBracket.deduction.toFixed(2)} = ${preTax.toFixed(2)}`);
                    
                    // 减半征收优惠
                    incomeTax = preTax * 0.5;
                    calculationSteps.push(`个体户减半征收: ${preTax.toFixed(2)} × 50% = ${incomeTax.toFixed(2)}`);
                }
                
                result.incomeTax = incomeTax;
                result.calculations.incomeTax = calculationSteps.join('<br>');
                
                // 计算附加税 (城建税7% + 教育费附加3% + 地方教育费附加2% = 12%)
                const surtaxRate = 0.12;
                result.surtax = result.vat * surtaxRate;
                result.calculations.surtax = `${result.vat.toFixed(2)} × 12% = ${result.surtax.toFixed(2)}`;
                
                // 计算印花税 (不含税收入的0.03%)
                result.stampTax = result.taxExcludedSales * 0.0003;
                result.calculations.stampTax = `${result.taxExcludedSales.toFixed(2)} × 0.03% = ${result.stampTax.toFixed(2)}`;
                
                // 计算总税费
                result.totalTax = result.vat + result.incomeTax + result.surtax + result.stampTax;
                
                // 计算税负率
                result.taxRate = result.totalTax / result.sales;
            }
            
            // 计算一般纳税人税费
            function calculateGeneralTax(result) {
                // 计算不含税销售额 (一般纳税人 13%)
                result.vatRate = 0.13;
                result.taxExcludedSales = result.sales / (1 + result.vatRate);
                result.calculations.taxExcludedSales = `${result.sales.toFixed(2)} ÷ (1 + 13%) = ${result.taxExcludedSales.toFixed(2)}`;
                
                // 获取专用发票比例
                const specialInvoiceRatio = parseFloat(document.getElementById('specialInvoiceRatio').value) || 0;
                const specialInvoiceRatioDecimal = specialInvoiceRatio / 100;
                
                // 计算销项税额和进项税额
                const outputVat = result.sales - result.taxExcludedSales;
                
                // 只有专用发票可以抵扣进项税额
                const deductibleCost = result.cost * specialInvoiceRatioDecimal;
                const inputTaxExcluded = deductibleCost / (1 + result.vatRate);
                const inputVat = deductibleCost - inputTaxExcluded;
                
                // 计算增值税 (一般纳税人不享受季度30万以下免增值税政策)
                const totalVat = Math.max(0, outputVat - inputVat);
                result.calculations.vat = `销项税额: ${outputVat.toFixed(2)} - 进项税额: ${inputVat.toFixed(2)} = ${totalVat.toFixed(2)}<br>
                                        专用发票比例: ${specialInvoiceRatio}%, 可抵扣成本: ${deductibleCost.toFixed(2)}元<br>
                                        一般纳税人不享受季度30万以下免增值税政策`;
                
                // 保存季度详情 (一般纳税人按季度平均计算)
                result.calculations.quarterlyDetails = [];
                result.quarterlySales.forEach((quarterlySale, index) => {
                    const quarter = index + 1;
                    const quarterlyOutputVat = quarterlySale / (1 + result.vatRate) * result.vatRate;
                    const quarterlyInputVat = inputVat * (quarterlySale / result.sales);
                    const quarterlyVat = Math.max(0, quarterlyOutputVat - quarterlyInputVat);
                    
                    result.calculations.quarterlyDetails.push({
                        quarter: quarter,
                        sales: quarterlySale,
                        vat: quarterlyVat,
                        isTaxExempt: false // 一般纳税人不享受免税
                    });
                });
                
                result.vat = totalVat;
                
                // 计算利润
                result.profit = result.taxExcludedSales - inputTaxExcluded;
                result.calculations.profit = `不含税销售额: ${result.taxExcludedSales.toFixed(2)} - 不含税成本: ${inputTaxExcluded.toFixed(2)} = ${result.profit.toFixed(2)}`;
                
                // 计算企业所得税 (300万以下5%，300万以上25%)
                const incomeTaxRate = result.profit <= 3000000 ? 0.05 : 0.25;
                result.incomeTax = result.profit * incomeTaxRate;
                result.calculations.incomeTax = `${result.profit.toFixed(2)} × ${(incomeTaxRate * 100).toFixed(0)}% = ${result.incomeTax.toFixed(2)}`;
                
                // 计算附加税 (城建税7% + 教育费附加3% + 地方教育费附加2% = 12%)
                const surtaxRate = 0.12;
                result.surtax = result.vat * surtaxRate;
                result.calculations.surtax = `${result.vat.toFixed(2)} × 12% = ${result.surtax.toFixed(2)}`;
                
                // 计算印花税 (不含税收入的0.03%)
                result.stampTax = result.taxExcludedSales * 0.0003;
                result.calculations.stampTax = `${result.taxExcludedSales.toFixed(2)} × 0.03% = ${result.stampTax.toFixed(2)}`;
                
                // 计算总税费
                result.totalTax = result.vat + result.incomeTax + result.surtax + result.stampTax;
                
                // 计算税负率
                result.taxRate = result.totalTax / result.sales;
            }
            
            // 计算个体工商户（核定征收）税费
            function calculateApprovedTax(result, approvedRateValue, deduction) {
                // 计算不含税销售额 (小规模纳税人 1%)
                result.vatRate = 0.01;
                result.taxExcludedSales = result.sales / (1 + result.vatRate);
                result.calculations.taxExcludedSales = `${result.sales.toFixed(2)} ÷ (1 + 1%) = ${result.taxExcludedSales.toFixed(2)}`;
                
                // 计算增值税
                // 小规模纳税人季度销售额30万以下免征增值税
                const quarterlySalesThreshold = 300000; // 季度销售额30万
                let totalVat = 0;
                let vatCalculationSteps = [];
                
                // 分季度计算增值税
                result.quarterlySales.forEach((quarterlySale, index) => {
                    const quarter = index + 1;
                    const quarterlyTaxExcluded = quarterlySale / (1 + result.vatRate);
                    let quarterlyVat = 0;
                    let quarterlyCalculation = '';
                    
                    if (quarterlySale <= quarterlySalesThreshold) {
                        quarterlyVat = 0;
                        quarterlyCalculation = `第${quarter}季度销售额${quarterlySale.toFixed(2)}元 ≤ 300000元，免征增值税`;
                    } else {
                        quarterlyVat = quarterlySale - quarterlyTaxExcluded;
                        quarterlyCalculation = `第${quarter}季度: ${quarterlySale.toFixed(2)} - ${quarterlyTaxExcluded.toFixed(2)} = ${quarterlyVat.toFixed(2)}`;
                    }
                    
                    totalVat += quarterlyVat;
                    vatCalculationSteps.push(quarterlyCalculation);
                    
                    // 保存季度详情
                    result.calculations.quarterlyDetails.push({
                        quarter: quarter,
                        sales: quarterlySale,
                        vat: quarterlyVat,
                        isTaxExempt: quarterlySale <= quarterlySalesThreshold
                    });
                });
                
                result.vat = totalVat;
                result.calculations.vat = vatCalculationSteps.join('<br>');
                
                // 计算利润 (核定征收不直接使用利润)
                result.profit = 0;
                result.calculations.profit = '核定征收不直接计算利润';
                
                // 计算核定应纳税所得额
                const approvedRate = approvedRateValue / 100;
                const taxableIncome = (result.taxExcludedSales * approvedRate) - deduction;
                const adjustedTaxableIncome = Math.max(0, taxableIncome); // 应纳税所得额不能为负数
                
                // 计算个体户所得税 (超额累进税率)
                let incomeTax = 0;
                let calculationSteps = [];
                
                calculationSteps.push(`不含税销售额: ${result.taxExcludedSales.toFixed(2)} × 核定率 ${(approvedRate * 100).toFixed(2)}% = ${(result.taxExcludedSales * approvedRate).toFixed(2)}`);
                calculationSteps.push(`减除费用: ${deduction.toFixed(2)}`);
                calculationSteps.push(`应纳税所得额: ${(result.taxExcludedSales * approvedRate).toFixed(2)} - ${deduction.toFixed(2)} = ${adjustedTaxableIncome.toFixed(2)}`);
                
                if (adjustedTaxableIncome > 0) {
                    // 个体户所得税税率表
                    const taxBrackets = [
                        { threshold: 30000, rate: 0.05, deduction: 0 },
                        { threshold: 90000, rate: 0.10, deduction: 1500 },
                        { threshold: 300000, rate: 0.20, deduction: 10500 },
                        { threshold: 500000, rate: 0.30, deduction: 40500 },
                        { threshold: Infinity, rate: 0.35, deduction: 65500 }
                    ];
                    
                    // 找到适用的税率档次
                    let applicableBracket = null;
                    for (const bracket of taxBrackets) {
                        if (adjustedTaxableIncome <= bracket.threshold) {
                            applicableBracket = bracket;
                            break;
                        }
                    }
                    
                    // 计算应纳税额
                    const preTax = adjustedTaxableIncome * applicableBracket.rate - applicableBracket.deduction;
                    calculationSteps.push(`${adjustedTaxableIncome.toFixed(2)} × ${(applicableBracket.rate * 100).toFixed(0)}% - ${applicableBracket.deduction.toFixed(2)} = ${preTax.toFixed(2)}`);
                    
                    // 减半征收优惠
                    incomeTax = preTax * 0.5;
                    calculationSteps.push(`个体户减半征收: ${preTax.toFixed(2)} × 50% = ${incomeTax.toFixed(2)}`);
                } else {
                    calculationSteps.push('应纳税所得额为0，无需缴纳所得税');
                }
                
                result.incomeTax = incomeTax;
                result.calculations.incomeTax = calculationSteps.join('<br>');
                
                // 计算附加税 (城建税7% + 教育费附加3% + 地方教育费附加2% = 12%)
                const surtaxRate = 0.12;
                result.surtax = result.vat * surtaxRate;
                result.calculations.surtax = `${result.vat.toFixed(2)} × 12% = ${result.surtax.toFixed(2)}`;
                
                // 计算印花税 (不含税收入的0.03%)
                result.stampTax = result.taxExcludedSales * 0.0003;
                result.calculations.stampTax = `${result.taxExcludedSales.toFixed(2)} × 0.03% = ${result.stampTax.toFixed(2)}`;
                
                // 计算总税费
                result.totalTax = result.vat + result.incomeTax + result.surtax + result.stampTax;
                
                // 计算税负率
                result.taxRate = result.totalTax / result.sales;
            }
            
            // 更新结果表格
            function updateResultTable(result, type) {
                // 清空表格
                resultTable.innerHTML = '';
                
                // 添加销售额行
                addResultRow('销售额', formatCurrency(result.sales), '用户输入');
                
                // 添加季度销售额详情
                if (result.quarterlySales && result.quarterlySales.length > 0) {
                    // 添加季度详情标题行
                    const quarterlyHeaderRow = document.createElement('tr');
                    quarterlyHeaderRow.innerHTML = `
                        <td colspan="3" class="table-cell font-bold bg-gray-50">季度销售额详情</td>
                    `;
                    resultTable.appendChild(quarterlyHeaderRow);
                    
                    // 添加季度季度详情行
                    result.quarterlySales.forEach((sales, index) => {
                        const quarter = index + 1;
                        const quarterlyDetail = result.calculations.quarterlyDetails[index];
                        const quarterlyVat = quarterlyDetail ? quarterlyDetail.vat : 0;
                        const isTaxExempt = quarterlyDetail ? quarterlyDetail.isTaxExempt : false;
                        
                        const quarterRow = document.createElement('tr');
                        quarterRow.innerHTML = `
                            <td class="table-cell">第${quarter}季度销售额</td>
                            <td class="table-cell">${formatCurrency(sales)}</td>
                            <td class="table-cell">
                                ${type === 'general' ? 
                                    `应缴增值税: ${formatCurrency(quarterlyVat)}<br><span class="text-xs text-gray-500">一般纳税人不享受免税</span>` :
                                    (isTaxExempt ? 
                                        `<span class="badge badge-success">免征增值税</span>` : 
                                        `应缴增值税: ${formatCurrency(quarterlyVat)}`
                                    )
                                }
                            </td>
                        `;
                        resultTable.appendChild(quarterRow);
                    });
                }
                
                // 添加进项成本票行 (非核定征收)
                if (type !== 'approved') {
                    addResultRow('进项(成本票)', formatCurrency(result.cost), '用户输入');
                    
                    // 添加专用发票比例行 (一般纳税人)
                    if (type === 'general') {
                        const specialInvoiceRatio = parseFloat(document.getElementById('specialInvoiceRatio').value) || 0;
                        const deductibleCost = result.cost * (specialInvoiceRatio / 100);
                        addResultRow('专用发票比例', `${specialInvoiceRatio}%`, `可抵扣成本: ${formatCurrency(deductibleCost)}元`);
                    }
                }
                
                // 添加不含税销售额行
                addResultRow('不含税销售额', formatCurrency(result.taxExcludedSales), result.calculations.taxExcludedSales);
                
                // 添加利润行
                if (type !== 'approved') {
                    addResultRow('利润', formatCurrency(result.profit), result.calculations.profit);
                }
                
                // 添加增值税行
                const vatValue = formatCurrency(result.vat);
                const vatDisplayValue = result.vat === 0 ? 
                    `<span class="flex items-center">${vatValue} <span class="ml-2 badge badge-success">免税</span></span>` : 
                    vatValue;
                addResultRow('增值税', vatDisplayValue, result.calculations.vat);
                
                // 添加所得税行
                const incomeTaxLabel = type === 'company' || type === 'general' ? '企业所得税' : '个体户所得税';
                addResultRow(incomeTaxLabel, formatCurrency(result.incomeTax), result.calculations.incomeTax);
                
                // 添加附加税行
                addResultRow('附加税', formatCurrency(result.surtax), result.calculations.surtax);
                
                // 添加印花税行
                addResultRow('印花税', formatCurrency(result.stampTax), result.calculations.stampTax);
                
                // 添加分隔行
                const separatorRow = document.createElement('tr');
                separatorRow.innerHTML = `
                    <td colspan="3" class="py-2 border-t border-b border-gray-200"></td>
                `;
                resultTable.appendChild(separatorRow);
                
                // 添加总税费行
                const totalRow = document.createElement('tr');
                totalRow.innerHTML = `
                    <td class="table-cell font-bold text-lg">总税费</td>
                    <td class="table-cell font-bold text-lg text-primary">${formatCurrency(result.totalTax)}</td>
                    <td class="table-cell"></td>
                `;
                resultTable.appendChild(totalRow);
                
                // 添加税负率行
                const rateRow = document.createElement('tr');
                rateRow.innerHTML = `
                    <td class="table-cell font-bold text-lg">综合税负率</td>
                    <td class="table-cell font-bold text-lg text-info">${formatPercentage(result.taxRate)}</td>
                    <td class="table-cell">总税费 ÷ 销售额</td>
                `;
                resultTable.appendChild(rateRow);
            }
            
            // 添加结果行
            function addResultRow(label, value, calculation) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="table-cell font-medium">${label}</td>
                    <td class="table-cell">${value}</td>
                    <td class="table-cell text-sm text-gray-600" style="white-space: normal;">${calculation}</td>
                `;
                resultTable.appendChild(row);
            }
            
            // 格式化货币
            function formatCurrency(value) {
                return value.toFixed(2);
            }
            
            // 格式化百分比
            function formatPercentage(value) {
                return (value * 100).toFixed(2) + '%';
            }
            
            // 初始化页面
            // 设置默认纳税人类型
            taxpayerType.value = 'company';
            
            // 隐藏季度销售额容器
            quarterlySalesContainer.classList.add('hidden');
            
            // 设置默认值
            salesAmount.value = '100000';
            costAmount.value = '50000';
            
            // 触发纳税人类型变化事件，初始化界面
            taxpayerType.dispatchEvent(new Event('change'));
            
            // 更新总销售额显示
            updateTotalSalesDisplay();
            
            // 触发一次计算，显示初始状态
            calculateTax();
        });
    </script>
</body>
</html>
